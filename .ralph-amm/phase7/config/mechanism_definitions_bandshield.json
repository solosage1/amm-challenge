{
  "schema_version": "1.0",
  "champion_file": ".best_strategy.sol",
  "champion_edge": 0.0,
  "mechanisms": {
    "fair_price_and_arb": {
      "current_implementation": "First-in-step fair estimation from fee-adjusted implied price, with arb-aware and retail-aware update gating.",
      "code_location": "afterSwap fair/arb inference region",
      "allowed_overlap_with": [
        "regime_estimators",
        "toxicity_and_activity"
      ],
      "anchors": [
        {
          "start": "re:uint256\\s+feeUsed\\s*=\\s*trade\\.isBuy\\s*\\?\\s*prevBidFee\\s*:\\s*prevAskFee\\s*;",
          "end": "re:uint256\\s+tradeRatio\\s*=\\s*trade\\.reserveY\\s*>\\s*0\\s*\\?\\s*wdiv\\(trade\\.amountY,\\s*trade\\.reserveY\\)\\s*:\\s*0\\s*;"
        }
      ],
      "parameters": {
        "PHAT_ALPHA_ARB_OR_MAIN": "strategy-specific",
        "PHAT_ALPHA_RETAIL": "strategy-specific",
        "PHAT_SHOCK_GATE_OR_ADAPTIVE": "strategy-specific",
        "ARB_MAX_RATIO_OR_ADAPTIVE_CAP": "strategy-specific"
      },
      "modification_directions": [
        "Tune arb-vs-retail update aggression without destabilizing pHat",
        "Use sigma-adaptive shock gate with floor/ceiling guardrails",
        "Adjust arb classification width using ratio and sigma context",
        "Improve implied-price robustness under extreme feeUsed values"
      ]
    },
    "regime_estimators": {
      "current_implementation": "Step-boundary decay and estimator updates for sigma/lambda/size/activity/step counters.",
      "code_location": "afterSwap step boundary and estimator maintenance",
      "allowed_overlap_with": [
        "fair_price_and_arb",
        "toxicity_and_activity"
      ],
      "anchors": [
        {
          "start": "re:bool\\s+isNewStep\\s*=\\s*trade\\.timestamp\\s*>\\s*lastTs\\s*;",
          "end": "re:stepTradeCount\\s*=\\s*0\\s*;"
        },
        {
          "start": "re:stepTradeCount\\s*=\\s*stepTradeCount\\s*\\+\\s*1\\s*;",
          "end": "re:if\\s*\\(stepTradeCount\\s*>\\s*STEP_COUNT_CAP\\)"
        }
      ],
      "parameters": {
        "ELAPSED_CAP": "strategy-specific",
        "DIR_DECAY": "strategy-specific",
        "ACT_DECAY": "strategy-specific",
        "SIZE_DECAY": "strategy-specific",
        "TOX_DECAY": "strategy-specific",
        "SIGMA_DECAY": "strategy-specific",
        "LAMBDA_DECAY": "strategy-specific"
      },
      "modification_directions": [
        "Tune decay constants for faster regime reaction without noise amplification",
        "Improve lambda estimation under sparse or bursty step patterns",
        "Refine stepTradeCount handling for boundary stability",
        "Adjust blended estimator weights to reduce oscillation"
      ]
    },
    "toxicity_and_activity": {
      "current_implementation": "Signal extraction for toxicity/activity and symmetric fee widening from tox/activity/flow components.",
      "code_location": "afterSwap toxicity/activity updates and mid-fee composition",
      "allowed_overlap_with": [
        "fair_price_and_arb",
        "regime_estimators",
        "directional_skew_and_stale_protection"
      ],
      "anchors": [
        {
          "start": "re:if\\s*\\(tradeRatio\\s*>\\s*SIGNAL_THRESHOLD\\)\\s*\\{",
          "end": "re:if\\s*\\(sizeHat\\s*>\\s*WAD\\)\\s*sizeHat\\s*=\\s*WAD\\s*;"
        },
        {
          "start": "re:uint256\\s+tox\\s*=\\s*pHat\\s*>\\s*0\\s*\\?\\s*wdiv\\(absDiff\\(spot,\\s*pHat\\),\\s*pHat\\)\\s*:\\s*0\\s*;",
          "end": "re:uint256\\s+fMid\\s*=\\s*fBase\\s*\\+\\s*wmul\\(TOX_COEF,\\s*toxSignal\\)"
        }
      ],
      "parameters": {
        "TOX_COEF": "strategy-specific",
        "TOX_QUAD_COEF": "strategy-specific",
        "TOX_CUBIC_COEF": "optional",
        "ACT_COEF": "strategy-specific",
        "FLOW_SIZE_COEF": "strategy-specific"
      },
      "modification_directions": [
        "Tune convex toxicity response (quadratic/cubic) to balance protection and routing share",
        "Improve activity widening while limiting over-penalization in calm periods",
        "Add or tune sigma-tox interaction terms when present",
        "Constrain tox caps/decays to reduce stale overreaction"
      ]
    },
    "directional_skew_and_stale_protection": {
      "current_implementation": "Directional skew from dirState and stale-sign overlays to defend vulnerable side while attracting safe flow.",
      "code_location": "afterSwap skew assignment and stale-direction protection blocks",
      "allowed_overlap_with": [
        "toxicity_and_activity",
        "tail_compression"
      ],
      "anchors": [
        {
          "start": "re:uint256\\s+dirDev\\s*;",
          "end": "re:uint256\\s+skew\\s*=\\s*wmul\\(DIR_COEF,\\s*dirDev\\)"
        },
        {
          "start": "re://\\s*(?:Additional\\s+)?[Dd]irectional protection using stale-price sign",
          "end": "re:bidFee\\s*=\\s*bidFee\\s*>\\s*(?:staleShift|attractShift)\\s*\\?\\s*bidFee\\s*-\\s*(?:staleShift|attractShift)\\s*:\\s*0\\s*;"
        },
        {
          "start": "re://\\s*Trade-aligned toxicity boost",
          "end": "re:askFee\\s*=\\s*askFee\\s*\\+\\s*tradeBoost\\s*;"
        }
      ],
      "parameters": {
        "DIR_COEF": "strategy-specific",
        "DIR_TOX_COEF": "strategy-specific",
        "STALE_DIR_COEF": "strategy-specific",
        "STALE_ATTRACT_FRAC": "optional",
        "TRADE_TOX_BOOST": "optional"
      },
      "modification_directions": [
        "Tune directional skew magnitude and tox coupling",
        "Calibrate stale-sign protection asymmetry for safer vulnerable-side defense",
        "Add or tune trade-aligned boost with strict bounded impact",
        "Reduce pathological over-skew under noisy directional bursts"
      ]
    },
    "tail_compression": {
      "current_implementation": "Tail compression to prevent routing starvation at extreme fees, with optional asymmetric slopes.",
      "code_location": "afterSwap fee compression calls and tail helper functions",
      "allowed_overlap_with": [
        "directional_skew_and_stale_protection"
      ],
      "anchors": [
        {
          "start": "re:bidFee\\s*=\\s*clampFee\\(_compressTail\\(",
          "end": "re:askFee\\s*=\\s*clampFee\\(_compressTail\\("
        },
        {
          "start": "re://\\s*Asymmetric tail compression",
          "end": "re:bidFee\\s*=\\s*clampFee\\(_compressTailWithSlope\\(bidFee,\\s*TAIL_SLOPE_ATTRACT\\)\\)\\s*;"
        },
        {
          "start": "re:function\\s+_compressTail(?:WithSlope)?\\(",
          "end": "re:return\\s+TAIL_KNEE\\s*\\+\\s*wmul\\(fee\\s*-\\s*TAIL_KNEE,\\s*(?:TAIL_SLOPE|slope)\\)\\s*;"
        }
      ],
      "parameters": {
        "TAIL_KNEE": "strategy-specific",
        "TAIL_SLOPE": "strategy-specific",
        "TAIL_SLOPE_PROTECT": "optional",
        "TAIL_SLOPE_ATTRACT": "optional"
      },
      "modification_directions": [
        "Tune knee placement to protect edge while preserving routing share",
        "Use asymmetric protect/attract slopes when beneficial",
        "Stabilize compression transitions to avoid abrupt behavior",
        "Constrain maximum effective fees in extreme tox regimes"
      ]
    }
  }
}
